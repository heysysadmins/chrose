<!doctype html>
<html>
    <head>
        <title>Fakemurk - Chrome OS Exploits</title>
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0" />
        <meta
            name="google-site-verification"
            content="GO1Hg4RaaWS5e6glGz85VfK_r_UflKBPw8aXRIG22WA" />
        <link
            rel="icon"
            href="../../assets/icon.png" />
        <link
            rel="preconnect"
            href="https://fonts.googleapis.com" />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=Google+Sans" />
        <link
            rel="stylesheet"
            href="../../main.css" />
        <link
            rel="stylesheet"
            href="../detail.css" />
        <script src="../addheader.js"></script>
        <script>
            window.ga =
                window.ga ||
                function () {
                    (ga.q = ga.q || []).push(arguments);
                };
            ga.l = +new Date();
            ga("create", "UA-XXXXX-Y", "auto");
            ga("send", "pageview");
        </script>
    </head>
    <body>
        <div id="main-content">
            <h3>
                <span class="title">Fakemurk</span>
                <br />
                <small>Mercury Workshop</small>
                <p>
                    <a
                        href="https://docs.google.com/document/d/1Pku_CbEG9SwQtnm0I188RtpdpW8nXQhiNdMp8PN7Mik"
                        target="_blank">
                        <svg
                            aria-hidden="true"
                            height="16"
                            viewBox="0 0 16 16"
                            version="1.1"
                            width="16"
                            data-view-component="true"
                            class="octicon octicon-link flex-shrink-0 mr-2">
                            <path
                                d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path>
                        </svg>
                        Website
                    </a>
                    <a
                        href="https://github.com/MercuryWorkshop/fakemurk"
                        target="_blank">
                        <svg
                            width="16"
                            viewBox="0 0 16 16">
                            <path
                                d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
                        </svg>
                        GitHub
                    </a>
                </p>
            </h3>
            Fakemurk blends your Chromebook in with the rest in the Admin
            console.
            <h3>How do I use this?</h3>
            <p>
                For the best results, it is recommended to recover with a v107
                recovery image before running the script. It makes things more
                consistent and less likely to fail.
            </p>
            <p>
                First, you want to already have an unenrolled Chromebook and you
                want to turn devmode on. You also might want to prepare a USB
                with the linux distro of your choice or Chrome OS Flex. Install
                <a
                    href="https://mrchromebox.tech/#fwscript"
                    target="_blank"
                    >MrChromebox's RW_LEGACY bios</a
                >
                if you haven't already.
            </p>
            Next, head over to chrome-untrusted://crosh, type
            <code>shell</code> and then type out the following commands
            <i><strong>one by one</strong></i>
            <div>
                <pre><code>sudo -i
        bash &lt;(curl -SLk https://github.com/MercuryWorkshop/fakemurk/releases/latest/download/fakemurk.sh)
        </code>
        <p>Follow all of the directions given by the script. Your Chromebook should reboot.</p>
        <h3>Tip</h3>
        <p>If you get an error about a filesystem being readonly run
        <code>fsck -f $(rootdev)</code>
        then reboot</p>
        <h3>Important Note</h3>
        <p>If you simply press ctrl-d on the devmode screen and proceed as normal, there's a good chance you'll be stuck on the "enrolling device" screen forever, then get an enrollment error complaining about a certificate.</p>
        <p>IF THIS HAPPENS, what you want to do is press refresh+power to reboot the Chromebook, when it gives you the os verification screen press space to <strong>disable devmode</strong>, and then press refresh+power. This will result in a "Chrome OS is missing or damaged" screen. THIS IS SUPPOSED TO HAPPEN!. Press escape+refresh+power, then ctrl+d and enter to <strong>reenable devmode</strong>. When you get back to the "OS verification screen" press Ctrl-D to boot.</p>
        <p>If you get another "Chrome OS is missing" screen, and you're absolutely sure that you didn't press space after the re-enable step, you might have run into a semi-common bug. We haven't pinned down the cause of this yet, but it can usually be fixed by downgrading/recovering to a 107 or 105 image, then restarting all the steps from the beginning, but <strong>make sure to omit the devmode cycle steps above</strong>, and just keep devmode on the entire time.</p>
        <p>Also, DO NOT use the sign out button to sign out of ChromeOS, use Power + Refresh or Reboot in crosh. If you use the sign out button there is a 90% chance your Chromebook will freeze then when it reboots, you will need to use Sh1mmer's disable block dev mode to remove the screen, don't worry. This is not the firmware blocking dev mode, just ChromeOS. So you can still use the Sh1mmer disable block dev mode on any CR50 version.</p>
        <p>(note that if you have a "dedede" Chromebook, the steps for enabling and disabling devmode are slightly different but you should already know or know how to google)</p>
        <h3>Version Reporting</h3>
        <p>Fakemurk does not fake reporting what version you're on. The longer you stay on the same version with fakemurk could start to raise flags as your version will be much lower. After a few months, consider recovering with a v107 recovery image, then run sh1mmer to unenroll, <strong>then update to the latest stable version</strong>, then use fakemurk, and repeat on new releases. You only need to do this every once in a while.</p>
        <h3>How it Works</h3>
        <p>Chrome OS interally uses a library called "crossystem" (Chrome OS system), which reports critical low-level information about the current state of the system, such as the hardware ID, and importantly here whether devmode is enabled or not. Since a lot of low level Chrome OS code is written in bash, it couldn't have crossystem be a c++ library, so it gets compiled to a static binary on the system instead. <code>crossystem</code> isn't the only internal library written like this, but it's the most important one. Again, if you want to know more about how this works, look at the <a href="https://coolelectronics.me/blog/breaking-cros-3" target="_blank">writeup</a>.</p>
        <p>Since the system trusts this crossystem file to tell if devmode is enabled and snitch about its status to the Google Admin Console, we can make our own version of this file that perpetually reports devmode being off, even though the system still lets us boot unverified versions of Chrome OS.</p>
        <p>This limbo state, however, comes with strings attached. As the OS thinks we're in verified mode, typing <code>shell</code> into crosh, and escalating to root with <code>sudo</code> does not work. Luckily, since the firmware is in developer mode, we can disable rootfs verification and drop a backdoored sshd config, as well as replace any binary in the system with our own custom script. This is where <code>mush</code> comes into play.</p>
        <p><code>mush</code> is a drop-in replacement for crosh, offering various utilites such as a shell and more. mush is what really ties fakemurk together, making it more than just developer mode on verified boot. With mush, you have full OS control without leaving CrOS. This effectively means you are in a pseudo developer mode, where as far as the OS is concerned everything is normal, but you have full behind-the-scenes shell access.</p>
        <p>Mush contains the following features:</p>
        <ol>
        <li>Extension disabler - allows you to toggle on and off any extension</li>
        <li>Root shell - gives you a bash shell as root. If you don't know what bash is ignore this</li>
        <li>Pollen editor - allows you to enable disable certain "policies" that administrators apply to your Chromebook. Note that any policies starting with "Device" cannot be modified by Pollen, and will require lilac instead.</li>
        <li>Emergency revert - will immediately reverse changes made by fakemurk and go back to a normal verified mode enrolled Chromebook.</li>
        </ol>
        <p>By default, the script will modify policies allowing you to do the following:</p>
        <ol>
        <li>Install any extension from the chrome web store</li>
        <li>Sign in to Google with any account type.</li>
        <li>Install any APK on the Google Play Store. If the Google Play Store appears blank, download the <a href="https://gitlab.com/AuroraOSS/AuroraStore/uploads/bbc1bd5a77ab2b40bbf288ccbef8d1f0/AuroraStore_4.1.1.apk" rel="nofollow">Aurora Store APK ↓</a> and sideload it with the package installer by right clicking on the file.</li>
        <li>Attempt to install crostini (usually won't work, do not make an issue if this breaks)</li>
        </ol>
        <h3>Crosh Blocked</h3>
        <p>Easy! While fakemurk is installed, go into your downloads folder (NOT GOOGLE DRIVE), make a folder and call it "disable-extensions". As long as that folder exists, no extension will be able to load and you'll be able to visit crosh, where you can then delete the folder and use mush to gain more fine-grain control over the specific extensions you want to enable.</p>
        <h3>Installing Help</h3>
        <p>If this doesn't work, there's an 85% chance you did something really dumb while installing and need to read the directions more carefully.</p>
        You should NOT ping or dm any of the creators about your failure.</pre>
                <p>
                    Now, there's also the chance that something is genuinely
                    broken and if you get the text
                    <code
                        >"THIS IS A BUG, REPORT IT HERE
                        https://github.com/MercuryWorkshop/fakemurk/issues"</code
                    >, you should do just that, but making sure you don't see
                    any duplicates first. Follow the
                    <a
                        href="https://github.com/MercuryWorkshop/fakemurk/blob/main/ISSUE_TEMPLATE"
                        target="_blank"
                        >issue template</a
                    >
                </p>
                <h3>Credits</h3>
                <ul>
                    <li>
                        r58Playz#3467 - created bash emulators for vpd and
                        crossystem, trawled through chromium source to find out
                        what needed to be patched
                    </li>
                    <li>
                        CoolElectronics#4683 - initial idea for the project,
                        created the installer
                    </li>
                    <li>
                        Rafflesia#8396 - found user policy modification, which
                        is used here
                    </li>
                    <li>
                        The rest of the Mercury Workshop team - assistance with
                        testing and miscellaneous files
                    </li>
                </ul>
            </div>
        </div>
    </body>
</html>
