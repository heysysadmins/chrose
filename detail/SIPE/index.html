<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0" />
        <title>Sync Internals Policy Extractor</title>
        <meta
            name="google-site-verification"
            content="GO1Hg4RaaWS5e6glGz85VfK_r_UflKBPw8aXRIG22WA" />
        <link
            rel="icon"
            href="../../assets/icon.png" />
        <link
            rel="preconnect"
            href="https://fonts.googleapis.com" />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=Google+Sans" />
        <link
            rel="stylesheet"
            href="../../main.css" />
        <link
            rel="stylesheet"
            href="../detail.css" />

        <style>
            html,
            body {
                width: 100%;
                height: 100%;
                background-color: #000;
                color: #fff;
                font-family:
                    system-ui,
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Roboto,
                    Oxygen,
                    Ubuntu,
                    Cantarell,
                    "Open Sans",
                    "Helvetica Neue",
                    monospace;
                font-size: 120%;
            }
        </style>
        <script>
            function hex(wifi) {
                return wifi
                    .split("")
                    .map((e) => e.charCodeAt(0).toString(16).padStart(2, "0"))
                    .join("")
                    .toUpperCase();
            }

            function dehex(wifi) {
                return wifi
                    .split(/(\w\w)/g)
                    .filter((e) => !!e)
                    .map((e) => String.fromCharCode(parseInt(e, 16)))
                    .join("");
            }

            function getInfo(internals_json) {
                info =
                    typeof internals_json === "string"
                        ? JSON.parse(internals_json)
                        : internals_json;
                return {
                    internals_name: info.NON_UNIQUE_NAME,
                    ssid: dehex(
                        atob(info.SPECIFICS.wifi_configuration.hex_ssid),
                    ),
                    password: atob(
                        info.SPECIFICS.wifi_configuration.passphrase,
                    ),
                };
            }
        </script>
    </head>
    <body>
        <form
            id="network-to-sync-node"
            onsubmit="
            event.preventDefault();
            document.getElementById('sync_name').innerHTML = `<code>${hex(event.target.elements['network-name'].value)}&lt;||&gt;psk</code>`;
     ">
            <label for="network-name">Network Name:</label>
            <input
                type="text"
                name="network-name" />
            <input
                type="submit"
                value="Get Network Sync Node" />
        </form>
        <br />
        <p>
            Go to chrome://sync-internals and click "Sync Node Browser". Then
            click "Wifi Configurations". Then click
            <span id="sync_name">the wifi that you want</span>. And copy the
            text that and is in curly braces. Paste it below and click Extract
            Password.
        </p>
        <br />
        <form
            onsubmit="
            event.preventDefault();
            info=getInfo(event.target.elements.json.value);
            document.getElementById('output').innerHTML=`<tr><td>Network Name</td><td>${info.ssid}</td></tr><tr><td>Password</td><td>${info.password}</td></tr>`
    ">
            <textarea
                name="json"
                rows="10"
                style="width: 100%"></textarea>
            <input
                type="submit"
                value="Extract Password" />
        </form>
        <table id="output"></table>
    </body>
</html>
